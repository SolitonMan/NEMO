{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}
<h2>Sequential Tool Scheduler</h2>
<form method="post">
	{% csrf_token %}
	{{ formset.management_form }}
	<table>
		<tr>
			<th>Tool</th>
			<th>Duration (minutes)</th>
		</tr>
		{% for form in formset %}
		<tr>
			<td>{{ form.tool|add_class:"form-control" }}</td>
			<td>{{ form.duration|add_class:"form-control" }}</td>
		</tr>
		{% endfor %}
		<tr id="empty-form-row" style="display:none;">
			<td>{{ formset.empty_form.tool|add_class:"form-control" }}</td>
			<td>{{ formset.empty_form.duration|add_class:"form-control" }}</td>
		</tr>
	</table>
	<button type="button" id="add-row" class="btn btn-success">Add Tool</button>
	<button type="submit" class="btn btn-success">Find Schedule</button>
</form>

{% if schedule %}
	<h3>Proposed Schedule</h3>
	<table>
		<tr>
			<th>Tool</th>
			<th>Start</th>
			<th>End</th>
		</tr>
		{% for item in schedule %}
		<tr>
			<td>{{ item.tool }}</td>
			<td>{{ item.start|date:"m/d/Y h:i A" }}</td>
			<td>{{ item.end|date:"m/d/Y h:i A" }}</td>
		</tr>
		{% endfor %}
	</table>
{% endif %}

<script>
document.getElementById('add-row').onclick = function() {
	var totalForms = document.getElementById('id_form-TOTAL_FORMS');
	var currentCount = parseInt(totalForms.value);
	var newRow = document.getElementById('empty-form-row').cloneNode(true);
	newRow.style.display = '';
	newRow.id = '';
	// Update the names and ids
	newRow.querySelectorAll('select, input').forEach(function(el) {
		el.name = el.name.replace('__prefix__', currentCount);
		el.id = el.id.replace('__prefix__', currentCount);
	});
	document.querySelector('form table').appendChild(newRow);
	totalForms.value = currentCount + 1;
};
</script>
{% endblock %}